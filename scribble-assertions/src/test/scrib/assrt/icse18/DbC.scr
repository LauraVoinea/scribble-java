//Raymond@HZHL3 ~/code/eclipse/scribble/github.com/rumineykova/scribble-java
//$ bin/scribblec-assrt.sh -ip scribble-assertions/src/test/scrib/ -d scribble-assertions/src/test/scrib/ scribble-assertions/src/test/scrib/assrt/tmp/AssrtTest.scr -V -ass Proto1


module assrt.icse18.DbC;


type <dotnet> "System.UInt32" from "..." as int;
//type <dotnet> "System.String" from "..." as str;


//*
global protocol Proto1(role B, role W, role S)
{
	1(Query:int) from B to W;      @(Query>0);
	2(Instock:int) from W to S;    @(Instock<Query);
	3a(Available:int) from S to B; @(Available=Instock);
	3b(Quote:int) from S to B;
	
	choice at B
	{
		ok() from B to S;   @(Available>0); 
		ok() from B to W; 
		do Proto2(B, W, S); @Quote;
	}
	or
	{
		quit() from B to S;
		quit() from B to W;
	}
}

aux global protocol Proto2(role B, role W, role S) @(x=0);
{
	5(Offer:int) from B to S;	
	choice at S
	{
		hag() from S to B;  @(Offer>x);
		hag() from S to W;  //@False;  // Uncomment is assert-prog error
		do Proto2(B, W, S); @Offer;
	}
	or
	{
		exit() from S to B;   //@False;  // Uncomment is still assert-prog, but unsat
		cancel() from S to W; //@False;  // Uncomment is assert-prog error if above is commented (otherwise this is assert-prog by false LHS, but anyway above is unsat)
	}
	or
	{
		sell() from S to B;
		commit() from S to W;
	}
}
//*/
